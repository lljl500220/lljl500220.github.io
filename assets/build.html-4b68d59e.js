const n=JSON.parse(`{"key":"v-5982b0f4","path":"/posts/learn/vue/build.html","title":"编写构建脚本","lang":"zh-CN","frontmatter":{"title":"编写构建脚本","icon":"edit","description":"build.js 在packages文件夹同级新建一个scripts文件夹，添加一个build.js文件。我们将通过这个文件来读取模块文件，并构建输出。 文件读取 由于vue3的核心代码使用分包的形式，分别写在packages/reactivity、packages/runtime-core、packages/shared等文件夹下，我们需要将这些文件读取出来，然后合并到一个文件中。 import fs from 'node:fs/promises'; //fs模块用于操作文件 import {existsSync,readfileSync} from 'node:fs'; //判断文件是否存在，读取文件 import path from 'node:path'; //path模块用于操作文件路径 import {cpus} from 'node:os'; //获取cpu核心数 //1. 读取文件夹 const dirs = readdirSync('../packages') //['reactivity','runtime-core','shared'...] //判断读取到的内容是否是packages下的文件夹 const dirs = readdirSync('../packages').filter(target =&gt; { return statSync(\`../packages/\${target}\`).isDirectory() }) //2. 并行打包 async function buildAll() { await runParallel(cpus().length, targets, build) }","head":[["meta",{"property":"og:url","content":"https://lljl500220.github.io/posts/learn/vue/build.html"}],["meta",{"property":"og:site_name","content":"秦篆"}],["meta",{"property":"og:title","content":"编写构建脚本"}],["meta",{"property":"og:description","content":"build.js 在packages文件夹同级新建一个scripts文件夹，添加一个build.js文件。我们将通过这个文件来读取模块文件，并构建输出。 文件读取 由于vue3的核心代码使用分包的形式，分别写在packages/reactivity、packages/runtime-core、packages/shared等文件夹下，我们需要将这些文件读取出来，然后合并到一个文件中。 import fs from 'node:fs/promises'; //fs模块用于操作文件 import {existsSync,readfileSync} from 'node:fs'; //判断文件是否存在，读取文件 import path from 'node:path'; //path模块用于操作文件路径 import {cpus} from 'node:os'; //获取cpu核心数 //1. 读取文件夹 const dirs = readdirSync('../packages') //['reactivity','runtime-core','shared'...] //判断读取到的内容是否是packages下的文件夹 const dirs = readdirSync('../packages').filter(target =&gt; { return statSync(\`../packages/\${target}\`).isDirectory() }) //2. 并行打包 async function buildAll() { await runParallel(cpus().length, targets, build) }"}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:locale","content":"zh-CN"}],["meta",{"property":"og:updated_time","content":"2024-04-15T09:08:37.000Z"}],["meta",{"property":"article:modified_time","content":"2024-04-15T09:08:37.000Z"}],["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"编写构建脚本\\",\\"image\\":[\\"\\"],\\"dateModified\\":\\"2024-04-15T09:08:37.000Z\\",\\"author\\":[]}"]]},"headers":[{"level":2,"title":"build.js","slug":"build-js","link":"#build-js","children":[{"level":3,"title":"文件读取","slug":"文件读取","link":"#文件读取","children":[]}]},{"level":2,"title":"rollup.config.js","slug":"rollup-config-js","link":"#rollup-config-js","children":[{"level":3,"title":"依赖","slug":"依赖","link":"#依赖","children":[]},{"level":3,"title":"处理常量","slug":"处理常量","link":"#处理常量","children":[]}]},{"level":2,"title":"执行打包","slug":"执行打包","link":"#执行打包","children":[]}],"git":{"createdTime":1712828287000,"updatedTime":1713172117000,"contributors":[{"name":"luolj","email":"luolj@si-tech.com.cn","commits":3},{"name":"lljl500220","email":"1723377108@qq.com","commits":1}]},"readingTime":{"minutes":6.67,"words":2000},"filePathRelative":"posts/learn/vue/build.md","localizedDate":"2024年4月11日","excerpt":"<h2> build.js</h2>\\n<p>在packages文件夹同级新建一个scripts文件夹，添加一个build.js文件。我们将通过这个文件来读取模块文件，并构建输出。</p>\\n<h3> 文件读取</h3>\\n<p>由于vue3的核心代码使用分包的形式，分别写在packages/reactivity、packages/runtime-core、packages/shared等文件夹下，我们需要将这些文件读取出来，然后合并到一个文件中。</p>\\n<div class=\\"language-javascript line-numbers-mode\\" data-ext=\\"js\\"><pre class=\\"language-javascript\\"><code><span class=\\"token keyword\\">import</span> fs <span class=\\"token keyword\\">from</span> <span class=\\"token string\\">'node:fs/promises'</span><span class=\\"token punctuation\\">;</span> <span class=\\"token comment\\">//fs模块用于操作文件</span>\\n<span class=\\"token keyword\\">import</span> <span class=\\"token punctuation\\">{</span>existsSync<span class=\\"token punctuation\\">,</span>readfileSync<span class=\\"token punctuation\\">}</span> <span class=\\"token keyword\\">from</span> <span class=\\"token string\\">'node:fs'</span><span class=\\"token punctuation\\">;</span> <span class=\\"token comment\\">//判断文件是否存在，读取文件</span>\\n<span class=\\"token keyword\\">import</span> path <span class=\\"token keyword\\">from</span> <span class=\\"token string\\">'node:path'</span><span class=\\"token punctuation\\">;</span> <span class=\\"token comment\\">//path模块用于操作文件路径</span>\\n<span class=\\"token keyword\\">import</span> <span class=\\"token punctuation\\">{</span>cpus<span class=\\"token punctuation\\">}</span> <span class=\\"token keyword\\">from</span> <span class=\\"token string\\">'node:os'</span><span class=\\"token punctuation\\">;</span> <span class=\\"token comment\\">//获取cpu核心数</span>\\n\\n<span class=\\"token comment\\">//1. 读取文件夹</span>\\n<span class=\\"token keyword\\">const</span> dirs <span class=\\"token operator\\">=</span> <span class=\\"token function\\">readdirSync</span><span class=\\"token punctuation\\">(</span><span class=\\"token string\\">'../packages'</span><span class=\\"token punctuation\\">)</span> <span class=\\"token comment\\">//['reactivity','runtime-core','shared'...]</span>\\n\\n<span class=\\"token comment\\">//判断读取到的内容是否是packages下的文件夹</span>\\n<span class=\\"token keyword\\">const</span> dirs <span class=\\"token operator\\">=</span> <span class=\\"token function\\">readdirSync</span><span class=\\"token punctuation\\">(</span><span class=\\"token string\\">'../packages'</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">.</span><span class=\\"token function\\">filter</span><span class=\\"token punctuation\\">(</span><span class=\\"token parameter\\">target</span> <span class=\\"token operator\\">=&gt;</span> <span class=\\"token punctuation\\">{</span>\\n    <span class=\\"token keyword\\">return</span> <span class=\\"token function\\">statSync</span><span class=\\"token punctuation\\">(</span><span class=\\"token template-string\\"><span class=\\"token template-punctuation string\\">\`</span><span class=\\"token string\\">../packages/</span><span class=\\"token interpolation\\"><span class=\\"token interpolation-punctuation punctuation\\">\${</span>target<span class=\\"token interpolation-punctuation punctuation\\">}</span></span><span class=\\"token template-punctuation string\\">\`</span></span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">.</span><span class=\\"token function\\">isDirectory</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span>\\n<span class=\\"token punctuation\\">}</span><span class=\\"token punctuation\\">)</span>\\n\\n<span class=\\"token comment\\">//2. 并行打包</span>\\n<span class=\\"token keyword\\">async</span> <span class=\\"token keyword\\">function</span> <span class=\\"token function\\">buildAll</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span> <span class=\\"token punctuation\\">{</span>\\n    <span class=\\"token keyword\\">await</span> <span class=\\"token function\\">runParallel</span><span class=\\"token punctuation\\">(</span><span class=\\"token function\\">cpus</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">.</span>length<span class=\\"token punctuation\\">,</span> targets<span class=\\"token punctuation\\">,</span> build<span class=\\"token punctuation\\">)</span>\\n<span class=\\"token punctuation\\">}</span>\\n\\n</code></pre><div class=\\"line-numbers\\" aria-hidden=\\"true\\"><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div></div></div>","autoDesc":true}`);export{n as data};
