---
title: vite插件，热更新
icon: vite
---

书接上回，上回我们讲到-赛博坦上起狼烟，黛玉七擒威震天！  

话说这赛博坦世界，本非金雕玉砌只邦，原是铁骨钢胎所在。那乾坤之间，不见日月轮转，唯有能量潮汐起落，紫霞青焰交织成昼夜....

偏题了不好意思，脱口相声下次再说，下面我们一起来看看vite的热更新，插件的内容

<!-- more -->

## HMR
曾经我面试过一个候选人，我问HMR是什么，他说不知道。我又问热更新是什么，他说是热更新...  

emmm，以上为真实场景，没有半点虚构，HMR，全名叫做Hot Module Replacement，顾名思义，热模块替换，也叫做热更新。

它有什么作用呢？ 写了代码，按下保存按键之后，不需要刷新页面就能看到改变，乃至于滚动条，表单状态都不会改变和丢失，现代前端框架几乎都已经实现了hmr的开发阶段功能。

### 核心原理

#### Websocket链接
众所周知，启动vite时，会启动一个服务器，浏览器上预览我们的页面时，实际上是请求了这个服务，他们之间会建立一个长链接的关系。vite监听到文件的变化后，会推送一个消息给
浏览器，浏览器就知道这个位置改变了，重新渲染一下。

#### 模块依赖图
上文说过，vite会维护一张模块之间的依赖图谱(Module Graph)，用于记录模块之间的引用关系，当某个模块变化后，顺着依赖图一直找，找到所有受影响的部分，就能实现精准的定位。

#### 为什么修改ts文件会发生整页刷新的情况